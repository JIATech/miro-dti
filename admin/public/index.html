<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Panel de Administración - Sistema Intercom</title>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.2.3/dist/css/bootstrap.min.css">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.3/font/bootstrap-icons.css">
    <link rel="stylesheet" href="css/styles.css">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://cdn.socket.io/4.6.0/socket.io.min.js"></script>
</head>
<body>
    <nav class="navbar navbar-expand-lg navbar-dark bg-primary">
        <div class="container-fluid">
            <a class="navbar-brand" href="#">
                <i class="bi bi-headset me-2"></i>Intercom Admin
            </a>
            <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNav">
                <span class="navbar-toggler-icon"></span>
            </button>
            <div class="collapse navbar-collapse" id="navbarNav">
                <ul class="navbar-nav me-auto">
                    <li class="nav-item">
                        <a class="nav-link active" href="#dashboard-tab" data-bs-toggle="tab">Dashboard</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="#logs-tab" data-bs-toggle="tab">Logs en Vivo</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="#services-tab" data-bs-toggle="tab">Servicios</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="#settings-tab" data-bs-toggle="tab">Configuración</a>
                    </li>
                </ul>
                <div class="d-flex">
                    <span class="navbar-text me-3">
                        <span class="badge bg-success" id="connection-status">Conectado</span>
                    </span>
                    <button class="btn btn-outline-light" id="btn-fullscreen">
                        <i class="bi bi-arrows-fullscreen"></i>
                    </button>
                </div>
            </div>
        </div>
    </nav>

    <div class="container-fluid">
        <div class="tab-content">
            <!-- DASHBOARD -->
            <div class="tab-pane fade show active" id="dashboard-tab">
                <div class="row my-3">
                    <div class="col-12">
                        <h2>Dashboard</h2>
                    </div>
                </div>
                
                <!-- Resumen -->
                <div class="row">
                    <div class="col-md-3 mb-3">
                        <div class="card text-white bg-primary">
                            <div class="card-body d-flex justify-content-between align-items-center">
                                <div>
                                    <h6 class="card-title">Llamadas Totales</h6>
                                    <h2 class="card-text" id="total-calls">0</h2>
                                </div>
                                <i class="bi bi-telephone-fill fs-1"></i>
                            </div>
                        </div>
                    </div>
                    <div class="col-md-3 mb-3">
                        <div class="card text-white bg-success">
                            <div class="card-body d-flex justify-content-between align-items-center">
                                <div>
                                    <h6 class="card-title">Llamadas Exitosas</h6>
                                    <h2 class="card-text" id="success-calls">0</h2>
                                </div>
                                <i class="bi bi-check-circle-fill fs-1"></i>
                            </div>
                        </div>
                    </div>
                    <div class="col-md-3 mb-3">
                        <div class="card text-white bg-danger">
                            <div class="card-body d-flex justify-content-between align-items-center">
                                <div>
                                    <h6 class="card-title">Llamadas Fallidas</h6>
                                    <h2 class="card-text" id="failed-calls">0</h2>
                                </div>
                                <i class="bi bi-x-circle-fill fs-1"></i>
                            </div>
                        </div>
                    </div>
                    <div class="col-md-3 mb-3">
                        <div class="card text-white bg-warning">
                            <div class="card-body d-flex justify-content-between align-items-center">
                                <div>
                                    <h6 class="card-title">Errores Totales</h6>
                                    <h2 class="card-text" id="total-errors">0</h2>
                                </div>
                                <i class="bi bi-exclamation-triangle-fill fs-1"></i>
                            </div>
                        </div>
                    </div>
                </div>
                
                <!-- Gráficos -->
                <div class="row">
                    <div class="col-md-6 mb-3">
                        <div class="card">
                            <div class="card-header">
                                Llamadas por Hora
                            </div>
                            <div class="card-body">
                                <canvas id="calls-chart" height="200"></canvas>
                            </div>
                        </div>
                    </div>
                    <div class="col-md-6 mb-3">
                        <div class="card">
                            <div class="card-header">
                                Errores por Tipo
                            </div>
                            <div class="card-body">
                                <canvas id="errors-chart" height="200"></canvas>
                            </div>
                        </div>
                    </div>
                </div>
                
                <!-- Estado del Sistema -->
                <div class="row">
                    <div class="col-md-6 mb-3">
                        <div class="card">
                            <div class="card-header">
                                Estado de Servicios
                            </div>
                            <div class="card-body">
                                <div id="services-status" class="table-responsive">
                                    <table class="table table-hover">
                                        <thead>
                                            <tr>
                                                <th>Servicio</th>
                                                <th>Estado</th>
                                                <th>Tiempo Activo</th>
                                                <th>Acciones</th>
                                            </tr>
                                        </thead>
                                        <tbody>
                                            <tr>
                                                <td colspan="4" class="text-center">Cargando...</td>
                                            </tr>
                                        </tbody>
                                    </table>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="col-md-6 mb-3">
                        <div class="card">
                            <div class="card-header">
                                Eventos del Sistema
                            </div>
                            <div class="card-body">
                                <div id="system-events" class="log-container">
                                    <div class="log-line">Sistema inicializado</div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- LOGS EN VIVO -->
            <div class="tab-pane fade" id="logs-tab">
                <div class="row my-3">
                    <div class="col-md-8">
                        <h2>Logs en Tiempo Real</h2>
                    </div>
                    <div class="col-md-4 text-end">
                        <div class="btn-group">
                            <button id="pause-logs" class="btn btn-secondary">
                                <i class="bi bi-pause-fill"></i> Pausar
                            </button>
                            <button id="clear-logs" class="btn btn-danger">
                                <i class="bi bi-trash"></i> Limpiar Vista
                            </button>
                        </div>
                    </div>
                </div>
                
                <div class="row mb-3">
                    <div class="col-12">
                        <div class="card">
                            <div class="card-header">
                                <ul class="nav nav-tabs card-header-tabs" id="log-tabs" role="tablist">
                                    <li class="nav-item" role="presentation">
                                        <a class="nav-link active" id="all-logs-tab" data-bs-toggle="tab" href="#all-logs" role="tab">Todos</a>
                                    </li>
                                    <li class="nav-item" role="presentation">
                                        <a class="nav-link" id="pwa-logs-tab" data-bs-toggle="tab" href="#pwa-logs" role="tab">PWA</a>
                                    </li>
                                    <li class="nav-item" role="presentation">
                                        <a class="nav-link" id="signaling-logs-tab" data-bs-toggle="tab" href="#signaling-logs" role="tab">Señalización</a>
                                    </li>
                                    <li class="nav-item" role="presentation">
                                        <a class="nav-link" id="mirotalksfu-logs-tab" data-bs-toggle="tab" href="#mirotalksfu-logs" role="tab">MiroTalkSFU</a>
                                    </li>
                                </ul>
                            </div>
                            <div class="card-body">
                                <div class="tab-content">
                                    <div class="tab-pane fade show active" id="all-logs" role="tabpanel">
                                        <div class="log-container" id="all-logs-container">
                                            <div class="text-center text-muted">Esperando logs...</div>
                                        </div>
                                    </div>
                                    <div class="tab-pane fade" id="pwa-logs" role="tabpanel">
                                        <div class="log-container" id="pwa-logs-container">
                                            <div class="text-center text-muted">Esperando logs...</div>
                                        </div>
                                    </div>
                                    <div class="tab-pane fade" id="signaling-logs" role="tabpanel">
                                        <div class="log-container" id="signaling-logs-container">
                                            <div class="text-center text-muted">Esperando logs...</div>
                                        </div>
                                    </div>
                                    <div class="tab-pane fade" id="mirotalksfu-logs" role="tabpanel">
                                        <div class="log-container" id="mirotalksfu-logs-container">
                                            <div class="text-center text-muted">Esperando logs...</div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            <div class="card-footer">
                                <div class="row align-items-center">
                                    <div class="col-auto">
                                        <div class="form-check form-switch">
                                            <input class="form-check-input" type="checkbox" id="auto-scroll" checked>
                                            <label class="form-check-label" for="auto-scroll">Auto-scroll</label>
                                        </div>
                                    </div>
                                    <div class="col-auto">
                                        <div class="form-check form-switch">
                                            <input class="form-check-input" type="checkbox" id="show-timestamps" checked>
                                            <label class="form-check-label" for="show-timestamps">Mostrar timestamps</label>
                                        </div>
                                    </div>
                                    <div class="col">
                                        <div class="input-group">
                                            <input type="text" class="form-control" id="log-filter" placeholder="Filtrar logs...">
                                            <button class="btn btn-outline-secondary" type="button" id="apply-filter">Filtrar</button>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- SERVICIOS -->
            <div class="tab-pane fade" id="services-tab">
                <div class="row my-3">
                    <div class="col-12">
                        <h2>Gestión de Servicios</h2>
                    </div>
                </div>
                
                <div class="row">
                    <div class="col-md-4 mb-3">
                        <div class="card">
                            <div class="card-header">PWA</div>
                            <div class="card-body">
                                <h5 class="card-title"><span id="pwa-status" class="badge bg-secondary">Desconocido</span></h5>
                                <p class="card-text">Interfaz web para los usuarios. Maneja la interacción y la lógica básica de la aplicación.</p>
                                <div class="d-grid gap-2">
                                    <button class="btn btn-primary" data-service="pwa" data-action="restart">
                                        <i class="bi bi-arrow-repeat"></i> Reiniciar Servicio
                                    </button>
                                    <a href="http://localhost:80" target="_blank" class="btn btn-outline-primary">
                                        <i class="bi bi-box-arrow-up-right"></i> Abrir en Nueva Pestaña
                                    </a>
                                </div>
                            </div>
                            <div class="card-footer text-muted" id="pwa-uptime">
                                Tiempo activo: --
                            </div>
                        </div>
                    </div>
                    
                    <div class="col-md-4 mb-3">
                        <div class="card">
                            <div class="card-header">Servidor de Señalización</div>
                            <div class="card-body">
                                <h5 class="card-title"><span id="signaling-status" class="badge bg-secondary">Desconocido</span></h5>
                                <p class="card-text">Coordina las llamadas entre dispositivos y gestiona el estado de la comunicación.</p>
                                <div class="d-grid gap-2">
                                    <button class="btn btn-primary" data-service="signaling" data-action="restart">
                                        <i class="bi bi-arrow-repeat"></i> Reiniciar Servicio
                                    </button>
                                    <a href="http://localhost:3000/health" target="_blank" class="btn btn-outline-primary">
                                        <i class="bi bi-activity"></i> Comprobar Estado
                                    </a>
                                </div>
                            </div>
                            <div class="card-footer text-muted" id="signaling-uptime">
                                Tiempo activo: --
                            </div>
                        </div>
                    </div>
                    
                    <div class="col-md-4 mb-3">
                        <div class="card">
                            <div class="card-header">MiroTalkSFU</div>
                            <div class="card-body">
                                <h5 class="card-title"><span id="mirotalksfu-status" class="badge bg-secondary">Desconocido</span></h5>
                                <p class="card-text">Servidor WebRTC que maneja las conexiones de video y audio para las llamadas.</p>
                                <div class="d-grid gap-2">
                                    <button class="btn btn-primary" data-service="mirotalksfu" data-action="restart">
                                        <i class="bi bi-arrow-repeat"></i> Reiniciar Servicio
                                    </button>
                                    <a href="http://localhost:8080" target="_blank" class="btn btn-outline-primary">
                                        <i class="bi bi-box-arrow-up-right"></i> Abrir en Nueva Pestaña
                                    </a>
                                </div>
                            </div>
                            <div class="card-footer text-muted" id="mirotalksfu-uptime">
                                Tiempo activo: --
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- CONFIGURACIÓN -->
            <div class="tab-pane fade" id="settings-tab">
                <div class="row my-3">
                    <div class="col-12">
                        <h2>Configuración del Sistema</h2>
                    </div>
                </div>
                
                <div class="row">
                    <div class="col-md-6 mb-3">
                        <div class="card">
                            <div class="card-header">Administración de Logs</div>
                            <div class="card-body">
                                <div class="mb-3">
                                    <label class="form-label">Rotación de Logs</label>
                                    <div class="input-group">
                                        <span class="input-group-text">Conservar</span>
                                        <input type="number" id="log-retention" class="form-control" value="7" min="1" max="30">
                                        <span class="input-group-text">días</span>
                                    </div>
                                    <div class="form-text">Los logs más antiguos serán eliminados automáticamente.</div>
                                </div>
                                
                                <div class="mb-3">
                                    <label class="form-label">Próxima Limpieza Programada</label>
                                    <input type="text" id="next-cleanup" class="form-control" readonly>
                                </div>
                                
                                <button id="btn-clean-logs" class="btn btn-warning">
                                    <i class="bi bi-trash"></i> Iniciar Limpieza Manual
                                </button>
                            </div>
                        </div>
                    </div>
                    
                    <div class="col-md-6 mb-3">
                        <div class="card">
                            <div class="card-header">Información del Sistema</div>
                            <div class="card-body">
                                <div class="row mb-3">
                                    <div class="col-md-6">
                                        <div class="mb-3">
                                            <label class="form-label">Tiempo Activo del Servidor</label>
                                            <input type="text" id="server-uptime" class="form-control" readonly>
                                        </div>
                                    </div>
                                    <div class="col-md-6">
                                        <div class="mb-3">
                                            <label class="form-label">Memoria Utilizada</label>
                                            <input type="text" id="memory-usage" class="form-control" readonly>
                                        </div>
                                    </div>
                                </div>
                                
                                <div class="mb-3">
                                    <label class="form-label">Estado de los Servicios</label>
                                    <ul class="list-group" id="services-health-list">
                                        <li class="list-group-item d-flex justify-content-between align-items-center">
                                            Cargando información de servicios...
                                        </li>
                                    </ul>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Notificaciones de Toast -->
    <div class="toast-container position-fixed bottom-0 end-0 p-3">
        <div id="notification-toast" class="toast" role="alert" aria-live="assertive" aria-atomic="true">
            <div class="toast-header">
                <strong class="me-auto" id="toast-title">Notificación</strong>
                <small id="toast-time">Ahora</small>
                <button type="button" class="btn-close" data-bs-dismiss="toast" aria-label="Close"></button>
            </div>
            <div class="toast-body" id="toast-body">
                Mensaje de notificación
            </div>
        </div>
    </div>

    <!-- Modal de confirmación -->
    <div class="modal fade" id="confirm-modal" tabindex="-1">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="confirm-title">Confirmar Acción</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body" id="confirm-message">
                    ¿Está seguro de que desea realizar esta acción?
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancelar</button>
                    <button type="button" class="btn btn-primary" id="confirm-btn">Confirmar</button>
                </div>
            </div>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.2.3/dist/js/bootstrap.bundle.min.js"></script>
    <script src="js/main.js"></script>
</body>
</html>
